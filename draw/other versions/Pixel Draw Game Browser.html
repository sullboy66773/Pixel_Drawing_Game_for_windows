<!DOCTYPE html>
<html>
<head>
  <title>Pixel Draw Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background: #f0f0f0;
      text-align: center;
    }
    #palette, #tools {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px;
    }
    .color {
      width: 32px;
      height: 32px;
      display: inline-block;
      margin: 4px;
      cursor: pointer;
      border: 2px solid #ccc;
      box-sizing: border-box;
    }
    .tool {
      margin: 5px;
      padding: 10px 16px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 6px;
    }
    canvas {
      touch-action: none;
      display: block;
    }
  </style>
</head>
<body>

<div id="palette"></div>
<div id="tools">
  <button class="tool" onclick="tool='brush'">Brush</button>
  <button class="tool" onclick="tool='eraser'">Eraser</button>
  <button class="tool" onclick="tool='fill'">Fill</button>
  <button class="tool" onclick="undo()">Undo</button>
  <button class="tool" onclick="redo()">Redo</button>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const size = 16;
let tileSize;
let tool = 'brush';
let currentColor = "#000000";
let drawing = false;

let grid = Array.from({ length: size }, () => Array(size).fill("#ffffff"));
let history = [];
let redoStack = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - document.getElementById("tools").offsetHeight - document.getElementById("palette").offsetHeight;
  tileSize = Math.min(canvas.width, canvas.height) / size;
  drawGrid();
}
window.addEventListener("resize", resizeCanvas);

function saveState() {
  history.push(JSON.parse(JSON.stringify(grid)));
  if (history.length > 100) history.shift();
  redoStack = [];
}

function undo() {
  if (history.length === 0) return;
  redoStack.push(JSON.parse(JSON.stringify(grid)));
  grid = history.pop();
  drawGrid();
}

function redo() {
  if (redoStack.length === 0) return;
  history.push(JSON.parse(JSON.stringify(grid)));
  grid = redoStack.pop();
  drawGrid();
}

function drawGrid() {
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      ctx.fillStyle = grid[y][x];
      ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
      ctx.strokeStyle = "#ddd";
      ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
    }
  }
}

function floodFill(x, y, targetColor, replacementColor) {
  if (targetColor === replacementColor || grid[y][x] !== targetColor) return;
  grid[y][x] = replacementColor;
  if (x > 0) floodFill(x - 1, y, targetColor, replacementColor);
  if (x < size - 1) floodFill(x + 1, y, targetColor, replacementColor);
  if (y > 0) floodFill(x, y - 1, targetColor, replacementColor);
  if (y < size - 1) floodFill(x, y + 1, targetColor, replacementColor);
}

function handleDraw(e, isStart = false) {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) / tileSize);
  const y = Math.floor((e.clientY - rect.top) / tileSize);
  if (x < 0 || y < 0 || x >= size || y >= size) return;

  if (isStart) saveState();

  if (tool === 'fill') {
    if (isStart) floodFill(x, y, grid[y][x], currentColor);
  } else if (tool === 'brush') {
    grid[y][x] = currentColor;
  } else if (tool === 'eraser') {
    grid[y][x] = "#ffffff";
  }

  drawGrid();
}

canvas.addEventListener("pointerdown", e => {
  drawing = true;
  handleDraw(e, true);
});

canvas.addEventListener("pointermove", e => {
  if (drawing) handleDraw(e);
});

canvas.addEventListener("pointerup", () => drawing = false);
canvas.addEventListener("pointerleave", () => drawing = false);

const paletteColors = [
  "#ff0000", "#ffa500", "#ffff00", "#00ff00", "#008000",
  "#add8e6", "#0000ff", "#800080", "#ffc0cb", "#c8a165",
  "#a52a2a", "#ffffff", "#d3d3d3", "#808080", "#000000"
];

const palette = document.getElementById("palette");
paletteColors.forEach(color => {
  const swatch = document.createElement("div");
  swatch.className = "color";
  swatch.style.background = color;
  swatch.onclick = () => currentColor = color;
  palette.appendChild(swatch);
});

resizeCanvas();
</script>

</body>
</html>